<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>System Scanner (Inventory)</title>
    <style>
      :root {
        --bg: #0b1020;
        --card: #121a33;
        --muted: #9fb0ff;
        --text: #e9edff;
        --ok: #32d583;
        --warn: #fdb022;
        --bad: #f97066;
        --line: #253056;
      }
      body {
        margin: 0;
        font-family: system-ui, Segoe UI, Tahoma;
        background: linear-gradient(180deg, #070b16, #0b1020);
        color: var(--text);
      }
      header {
        padding: 18px 20px;
        border-bottom: 1px solid var(--line);
        display: flex;
        align-items: center;
        gap: 12px;
      }
      header h1 {
        font-size: 16px;
        margin: 0;
      }
      header .pill {
        font-size: 12px;
        color: var(--muted);
        border: 1px solid var(--line);
        padding: 6px 10px;
        border-radius: 999px;
      }
      main {
        padding: 18px 20px;
        max-width: 1100px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 320px 1fr;
        gap: 14px;
      }
      .card {
        background: rgba(18, 26, 51, 0.88);
        border: 1px solid var(--line);
        border-radius: 14px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.25);
      }
      .card h2 {
        margin: 0;
        font-size: 14px;
        padding: 14px 14px 10px;
        border-bottom: 1px solid var(--line);
      }
      .card .content {
        padding: 12px 14px 14px;
      }
      button {
        width: 100%;
        background: #1c2a58;
        color: var(--text);
        border: 1px solid #2b3a74;
        padding: 12px 12px;
        border-radius: 12px;
        cursor: pointer;
        font-weight: 600;
      }
      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }
      .row {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }
      .row button {
        width: auto;
        flex: 1;
      }
      .status {
        margin-top: 10px;
        font-size: 12px;
        color: var(--muted);
        display: flex;
        gap: 10px;
        align-items: center;
      }
      .dot {
        width: 9px;
        height: 9px;
        border-radius: 50%;
        background: var(--warn);
      }
      .dot.ok {
        background: var(--ok);
      }
      .dot.bad {
        background: var(--bad);
      }
      .tabs {
        display: flex;
        gap: 8px;
        padding: 10px 14px;
        border-bottom: 1px solid var(--line);
        flex-wrap: wrap;
      }
      .tab {
        font-size: 12px;
        padding: 8px 10px;
        border: 1px solid var(--line);
        border-radius: 10px;
        cursor: pointer;
        color: var(--muted);
      }
      .tab.active {
        background: #1a2550;
        color: var(--text);
        border-color: #2b3a74;
      }
      pre {
        margin: 0;
        padding: 14px;
        overflow: auto;
        max-height: 70vh;
        background: rgba(9, 12, 24, 0.7);
        border-radius: 12px;
        border: 1px solid rgba(37, 48, 86, 0.7);
        font-size: 12px;
        line-height: 1.55;
      }
      .kv {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
      }
      .kv .item {
        border: 1px dashed rgba(37, 48, 86, 0.9);
        border-radius: 12px;
        padding: 10px;
      }
      .kv .k {
        font-size: 11px;
        color: var(--muted);
        margin-bottom: 4px;
      }
      .kv .v {
        font-size: 13px;
        word-break: break-word;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>ğŸ”¨ğŸ¤–ğŸ”§ System Inventory Scanner</h1>
      <span class="pill">Local Only â€¢ Read-Only</span>
    </header>

    <main>
      <section class="card">
        <h2>Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§</h2>
        <div class="content">
          <button id="btnScan">Ø´Ø±ÙˆØ¹ Ø§Ø³Ú©Ù†</button>
          <div class="row">
            <button id="btnExport" disabled>Ø®Ø±ÙˆØ¬ÛŒ JSON</button>
            <button id="btnClear">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù†</button>
          </div>

          <div class="status">
            <span class="dot" id="dot"></span>
            <span id="statusText">Ø¢Ù…Ø§Ø¯Ù‡</span>
          </div>

          <div style="margin-top: 12px" class="kv" id="summary"></div>
        </div>
      </section>

      <section class="card">
        <div class="tabs" id="tabs">
          <div class="tab active" data-tab="pretty">Ù†Ù…Ø§ÛŒØ´ Ø®Ù„Ø§ØµÙ‡</div>
          <div class="tab" data-tab="raw">Ø®Ø±ÙˆØ¬ÛŒ Ø®Ø§Ù…</div>
        </div>
        <div class="content">
          <div id="prettyView"></div>
          <pre id="rawView" style="display: none">{}</pre>
        </div>
      </section>
    </main>

    <script>
      // Ø§ÛŒÙ† UI Ø§Ù†ØªØ¸Ø§Ø± Ø¯Ø§Ø±Ø¯ backend Ø´Ù…Ø§ ÛŒÚ© endpoint Ù…Ø«Ù„ /api/scan Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯ Ú©Ù‡ JSON Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯.
      // Ø§Ú¯Ø± Electron/Node Ø¯Ø§Ø±ÛŒØ¯ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² IPC ÛŒØ§ ÛŒÚ© Ø³Ø±ÙˆØ± Ù…Ø­Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.

      const btnScan = document.getElementById("btnScan");
      const btnExport = document.getElementById("btnExport");
      const btnClear = document.getElementById("btnClear");
      const statusText = document.getElementById("statusText");
      const dot = document.getElementById("dot");

      const rawView = document.getElementById("rawView");
      const prettyView = document.getElementById("prettyView");
      const summary = document.getElementById("summary");

      const tabs = document.getElementById("tabs");
      let lastData = null;

      function setStatus(type, text) {
        dot.className = "dot" + (type ? " " + type : "");
        statusText.textContent = text;
      }

      function escapeHtml(s) {
        return String(s).replace(
          /[&<>"']/g,
          (m) =>
            ({
              "&": "&amp;",
              "<": "&lt;",
              ">": "&gt;",
              '"': "&quot;",
              "'": "&#39;",
            }[m])
        );
      }

      function renderSummary(data) {
        // Ú†Ù†Ø¯ ÙÛŒÙ„Ø¯ Ú©Ù„ÛŒØ¯ÛŒ Ø±Ø§ Ù†Ø´Ø§Ù† Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
        const items = [];
        const os = data?.os?.name
          ? `${data.os.name} (${data.os.version || ""})`
          : "â€”";
        const cpu = data?.hardware?.cpu?.model || "â€”";
        const ram =
          data?.hardware?.memory?.totalGB != null
            ? `${data.hardware.memory.totalGB} GB`
            : "â€”";
        const host = data?.network?.hostname || "â€”";

        items.push({ k: "Hostname", v: host });
        items.push({ k: "OS", v: os });
        items.push({ k: "CPU", v: cpu });
        items.push({ k: "RAM", v: ram });

        summary.innerHTML = items
          .map(
            (x) => `
      <div class="item">
        <div class="k">${escapeHtml(x.k)}</div>
        <div class="v">${escapeHtml(x.v)}</div>
      </div>
    `
          )
          .join("");
      }

      function renderPretty(data) {
        // Ù†Ù…Ø§ÛŒØ´ Ø³Ø§Ø®ØªØ§Ø±ÛŒØ§ÙØªÙ‡
        const blocks = [];

        function block(title, obj) {
          blocks.push(`
        <div class="card" style="margin-bottom:12px">
          <h2 style="border-bottom:1px solid var(--line); padding:12px 12px 10px; font-size:13px">${escapeHtml(
            title
          )}</h2>
          <div class="content">
            <pre style="max-height:none">${escapeHtml(
              JSON.stringify(obj, null, 2)
            )}</pre>
          </div>
        </div>
      `);
        }

        block("OS", data.os || {});
        block("Hardware", data.hardware || {});
        block("Network", data.network || {});
        block("Local Listening Ports", data.localPorts || []); // ÙÙ‚Ø· Ù¾ÙˆØ±Øªâ€ŒÙ‡Ø§ÛŒ listen Ø±ÙˆÛŒ Ù‡Ù…ÛŒÙ† Ø³ÛŒØ³ØªÙ…
        block("Notes", data.notes || {});

        prettyView.innerHTML = blocks.join("");
      }

      async function scan() {
        btnScan.disabled = true;
        btnExport.disabled = true;
        setStatus("", "Ø¯Ø± Ø­Ø§Ù„ Ø§Ø³Ú©Ù†â€¦");

        try {
          // Ø´Ù…Ø§ Ø§ÛŒÙ† endpoint Ø±Ø§ Ø¯Ø± backend Ù¾ÛŒØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯:
          // Ø®Ø±ÙˆØ¬ÛŒ Ù†Ù…ÙˆÙ†Ù‡ Ø¯Ø± Ù¾Ø§ÛŒÛŒÙ† ØªÙˆØ¶ÛŒØ­ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
          const res = await fetch("/api/scan", { method: "GET" });
          if (!res.ok) throw new Error("Scan failed: " + res.status);
          const data = await res.json();

          lastData = data;
          rawView.textContent = JSON.stringify(data, null, 2);
          renderSummary(data);
          renderPretty(data);

          btnExport.disabled = false;
          setStatus("ok", "Ø§Ø³Ú©Ù† Ú©Ø§Ù…Ù„ Ø´Ø¯ âœ”ï¸");
        } catch (err) {
          console.error(err);
          setStatus("bad", "Ø®Ø·Ø§ Ø¯Ø± Ø§Ø³Ú©Ù† â— (backend/Ù…Ø¬ÙˆØ²Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯)");
          rawView.textContent = JSON.stringify({ error: String(err) }, null, 2);
          prettyView.innerHTML = "";
          summary.innerHTML = "";
          lastData = null;
        } finally {
          btnScan.disabled = false;
        }
      }

      function exportJson() {
        if (!lastData) return;
        const blob = new Blob([JSON.stringify(lastData, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "system-scan.json";
        a.click();
        URL.revokeObjectURL(url);
      }

      function clearAll() {
        lastData = null;
        rawView.textContent = "{}";
        prettyView.innerHTML = "";
        summary.innerHTML = "";
        btnExport.disabled = true;
        setStatus("", "Ø¢Ù…Ø§Ø¯Ù‡");
      }

      tabs.addEventListener("click", (e) => {
        const tab = e.target.closest(".tab");
        if (!tab) return;
        [...tabs.querySelectorAll(".tab")].forEach((t) =>
          t.classList.remove("active")
        );
        tab.classList.add("active");
        const key = tab.dataset.tab;
        if (key === "raw") {
          rawView.style.display = "block";
          prettyView.style.display = "none";
        } else {
          rawView.style.display = "none";
          prettyView.style.display = "block";
        }
      });

      btnScan.addEventListener("click", scan);
      btnExport.addEventListener("click", exportJson);
      btnClear.addEventListener("click", clearAll);
    </script>
  </body>
</html>
